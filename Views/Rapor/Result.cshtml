@model ISGKkdTakip.Models.ViewModels.ImageUploadViewModel


@{
    var hardhats = ViewBag.Hardhats != null ? (int)ViewBag.Hardhats : 0;
    var vests = ViewBag.Vests != null ? (int)ViewBag.Vests : 0;
    var goggles = ViewBag.Goggles != null ? (int)ViewBag.Goggles : 0;
    var masks = ViewBag.Masks != null ? (int)ViewBag.Masks : 0;
    var processedImagePath = ViewBag.ProcessedImagePath != null ? (string)ViewBag.ProcessedImagePath : null;
}


<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <title>Analiz Sonucu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-6">

    <div class="max-w-5xl mx-auto bg-white p-8 rounded-lg shadow">
        <h1 class="text-2xl font-bold mb-6 text-center">ðŸ“Š KKD Tespit Sonucu</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-stretch">

            <div class="md:col-span-1 p-4 bg-gray-50 rounded-lg shadow-sm flex flex-col justify-between"> <h2 class="text-xl font-semibold mb-4">Tespit Edilen KKD'ler</h2>
                <ul class="text-lg space-y-2">
                    <li><strong>Kask:</strong> @hardhats adet</li>
                    <li><strong>Yelek:</strong> @vests adet</li>
                    <li><strong>GÃ¶zlÃ¼k:</strong> @goggles adet</li>
                    <li><strong>Maske:</strong> @masks adet</li>
                </ul>
            </div>

            <div class="md:col-span-1 p-4 bg-gray-50 rounded-lg shadow-sm flex flex-col justify-center items-center relative">
                <h2 class="text-xl font-semibold mb-4 text-center w-full absolute top-0 pt-4">DaÄŸÄ±lÄ±m GrafiÄŸi</h2>
                <div class="w-full max-w-xs mt-8"> <canvas id="donutChart"></canvas>
                </div>
            </div>

            <div class="md:col-span-1 p-4 bg-gray-50 rounded-lg shadow-sm flex flex-col justify-center items-center relative">
                <h2 class="text-xl font-semibold mb-4 text-center w-full absolute top-0 pt-4">Ä°ÅŸlenmiÅŸ GÃ¶rsel</h2>
                @if (ViewBag.ProcessedImagePath != null)
                {
                    <img src="@ViewBag.ProcessedImagePath?t=@DateTime.UtcNow.Ticks" alt="Ä°ÅŸlenmiÅŸ GÃ¶rsel" class="rounded shadow-lg w-full h-auto max-w-sm" />
                }
                else
                {
                    <p class="text-red-500 text-center">Ä°ÅŸlenmiÅŸ gÃ¶rsel bulunamadÄ±.</p>
                }
            </div>
        </div>

        <div class="mt-8 text-center">
            <a asp-controller="ImagePrediction" asp-action="Index" class="bg-gray-700 text-white px-6 py-3 rounded-lg hover:bg-gray-900 transition duration-300">
                Yeni GÃ¶rsel YÃ¼kle
            </a>
        </div>
       <form asp-action="Kiyasla" asp-controller="ImagePrediction" method="get" class="mt-4">
    <input type="hidden" name="mekanId" value="@Model.SelectedMekanId" />
    <button type="submit" class="btn btn-primary mt-2">ðŸ“Š KÄ±yasla</button>
</form>

        
    </div>

    <script>
        const data = {
            labels: ['Kask', 'Yelek', 'GÃ¶zlÃ¼k', 'Maske'],
            datasets: [{
                data: [@hardhats, @vests, @goggles, @masks],
                backgroundColor: [
                    '#4B9CD3', // Kask iÃ§in mavi
                    '#FFC107', // Yelek iÃ§in sarÄ±
                    '#8BC34A', // GÃ¶zlÃ¼k iÃ§in yeÅŸil
                    '#E91E63'  // Maske iÃ§in pembe
                ],
                borderWidth: 1
            }]
        };

        const config = {
            type: 'doughnut',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false, // Konteynerin boyutuna gÃ¶re ayarlanÄ±r
                plugins: {
                    legend: {
                        position: 'bottom', // Efsanevi (legend) alta konumlandÄ±rÄ±ldÄ±
                        labels: {
                            font: {
                                size: 14 // Legend etiketlerinin font boyutu
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return tooltipItem.label + ': ' + tooltipItem.raw + ' adet'; // Tooltip'te etiket ve deÄŸer gÃ¶sterilir
                            }
                        },
                        titleFont: {
                            size: 16
                        },
                        bodyFont: {
                            size: 14
                        }
                    }
                },
                layout: {
                    padding: {
                        top: 20 // GrafiÄŸin Ã¼stÃ¼nden biraz boÅŸluk bÄ±rakÄ±r (baÅŸlÄ±k iÃ§in)
                    }
                }
            }
        };

        // Canvas elementini al ve grafiÄŸi oluÅŸtur
        const donutChart = document.getElementById('donutChart');
        if (donutChart) { // Elementin varlÄ±ÄŸÄ±nÄ± kontrol et
            new Chart(donutChart, config);
        }
    </script>

</body>
</html>